<!doctype html><html lang=en dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-development/dev-common" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.7.0"><title data-rh=true>Common Development | Multi-Scrobbler</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://foxxmd.github.io/multi-scrobbler/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://foxxmd.github.io/multi-scrobbler/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://foxxmd.github.io/multi-scrobbler/docs/development/dev-common/><meta data-rh=true property=og:locale content=en><meta data-rh=true name=docusaurus_locale content=en><meta data-rh=true name=docsearch:language content=en><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Common Development | Multi-Scrobbler"><meta data-rh=true name=description content="Start here for MS development"><meta data-rh=true property=og:description content="Start here for MS development"><link data-rh=true rel=icon href=/multi-scrobbler/img/favicon.ico><link data-rh=true rel=canonical href=https://foxxmd.github.io/multi-scrobbler/docs/development/dev-common/><link data-rh=true rel=alternate href=https://foxxmd.github.io/multi-scrobbler/docs/development/dev-common/ hreflang=en><link data-rh=true rel=alternate href=https://foxxmd.github.io/multi-scrobbler/docs/development/dev-common/ hreflang=x-default><script src=https://insight.foxxmd.dev/js/script.hash.outbound-links.tagged-events.js defer data-domain=foxxmd.github.io></script><link rel=stylesheet href=/multi-scrobbler/assets/css/styles.a3e182a3.css><script src=/multi-scrobbler/assets/js/runtime~main.7a409a9d.js defer></script><script src=/multi-scrobbler/assets/js/main.d25f08e4.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"dark",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Skip to main content"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Skip to main content</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Toggle navigation bar" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/multi-scrobbler/><div class=navbar__logo><img src=/multi-scrobbler/img/icon.svg alt=Logo class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/multi-scrobbler/img/icon.svg alt=Logo class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Multi-Scrobbler</b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/multi-scrobbler/docs/quickstart/>Docs</a><a class="navbar__item navbar__link" href=/multi-scrobbler/playground/>Config Playground</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/foxxmd/multi-scrobbler target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><a href=https://foxxmd.github.io/multi-scrobbler/ target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">Website<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live=polite aria-pressed=true><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=Search aria-label=Search class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/multi-scrobbler/docs/quickstart/>Quickstart</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/multi-scrobbler/docs/category/installation/>Installation</a><button aria-label="Expand sidebar category 'Installation'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/multi-scrobbler/docs/category/configuration/>Configuration</a><button aria-label="Expand sidebar category 'Configuration'" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/multi-scrobbler/docs/category/development/>Development</a><button aria-label="Collapse sidebar category 'Development'" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/multi-scrobbler/docs/development/dev-common/>Common Development</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/multi-scrobbler/docs/development/dev-source/>Source Development/Tutorial</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/multi-scrobbler/docs/development/dev-client/>Client Development/Tutorial</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/multi-scrobbler/docs/development/flatpak/>Flatpak</a></ul><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/multi-scrobbler/docs/FAQ/>FAQ</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/multi-scrobbler/playground/>Config Playground</a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label=Breadcrumbs><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Home page" class=breadcrumbs__link href=/multi-scrobbler/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/multi-scrobbler/docs/category/development/><span itemprop=name>Development</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Common Development</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Development</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=architecture>Architecture<a href=#architecture class=hash-link aria-label="Direct link to Architecture" title="Direct link to Architecture">​</a></h2>
<p>Multi-scrobbler is written entirely in <a href=https://www.typescriptlang.org/ target=_blank rel="noopener noreferrer">Typescript</a>. It consists of a backend and frontend. The backend handles all Source/Client logic, mounts web server endpoints that listen for Auth callbacks and Source ingress using <a href=https://expressjs.com/ target=_blank rel="noopener noreferrer">expressjs</a>, and  serves the frontend. The frontend is a standalone <a href=https://vitejs.dev/ target=_blank rel="noopener noreferrer">Vitejs</a> app that communicates via API to the backend in order to render the dashboard.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=project-setup>Project Setup<a href=#project-setup class=hash-link aria-label="Direct link to Project Setup" title="Direct link to Project Setup">​</a></h2>
<p>Development requires <a href=https://nodejs.org/en target=_blank rel="noopener noreferrer">Node v18.19.1</a> or higher is installed on your system.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 12 16"><path fill-rule=evenodd d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"/></svg></span>tip</div><div class=admonitionContent_BuS1><p>When running locally (not with a devcontainer) you can use <a href=https://github.com/nvm-sh/nvm target=_blank rel="noopener noreferrer">nvm</a> to manage the installed node version.</div></div>
<p>Clone this repository somewhere and then install from the working directory</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/FoxxMD/multi-scrobbler.git </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">.</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> multi-scrobbler</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">nvm use </span><span class="token comment" style="color:rgb(98, 114, 164)"># optional, sets correct node version when running without devcontainer</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">npm</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">npm</span><span class="token plain"> run start</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=vscode>VSCode<a href=#vscode class=hash-link aria-label="Direct link to VSCode" title="Direct link to VSCode">​</a></h3>
<p>This repository contains <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/.devcontainer target=_blank rel="noopener noreferrer">workspace settings</a> for development with VSCode. These include:</p>
<ul>
<li>Run/Debug <a href=https://code.visualstudio.com/Docs/editor/debugging#_launch-configurations target=_blank rel="noopener noreferrer">Launch configurations</a> for the application and tests</li>
<li><a href=https://code.visualstudio.com/docs/devcontainers/containers target=_blank rel="noopener noreferrer">Devcontainer</a> for development with all dependencies already installed</li>
<li>Useful extensions for linting and running tests</li>
</ul>
<p>To use the Devcontainer simple open the repository in VSCode and "Use Devcontainer" when the notification is presented. <code>npm install</code> will be run when a new container is created.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=common-development>Common Development<a href=#common-development class=hash-link aria-label="Direct link to Common Development" title="Direct link to Common Development">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>In this document, when referring to aspects of Sources and Clients that are shared between both, the Source/Client will be referred to as a <strong>Component.</strong></div></div>
<p>A Component is composed of two parts:</p>
<ul>
<li>Typescript interfaces describing structure of configuration for that Component</li>
<li>A concrete class inheriting from a common "startup" abstract class that enforces how the Component is built and operates</li>
</ul>
<p>In both parts Source/Clients share some common properties/behavior before diverging in how they operate.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=config>Config<a href=#config class=hash-link aria-label="Direct link to Config" title="Direct link to Config">​</a></h3>
<p>The configuration for a Component should always have this minimum shape, enforced respectively by the interfaces <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/src/backend/common/infrastructure/config/source/index.ts#L105 target=_blank rel="noopener noreferrer">CommonSourceConfig</a> and <a href=https://github.com/FoxxMD/multi-scrobbler/blob/ce1c70a4e1e87fb5bea7cca960eaafbd15881a1f/src/backend/common/infrastructure/config/client/index.ts#L68 target=_blank rel="noopener noreferrer">CommonClientConfig</a>:</p>
<div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#F8F8F2;--prism-background-color:#282A36><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-ts codeBlock_bY9V thin-scrollbar" style=color:#F8F8F2;background-color:#282A36><code class=codeBlockLines_e6Vv><span class=token-line style=color:#F8F8F2><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name">MyConfig</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  name</span><span class="token operator">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token plain"></span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  data</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> object</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain">  options</span><span class="token operator">?</span><span class="token operator">:</span><span class="token plain"> object</span><br></span><span class=token-line style=color:#F8F8F2><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copy code to clipboard" title=Copy class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<ul>
<li><code>data</code> contains data that is required for a Component to operate such as credentials, callback urls, api keys, endpoints, etc...</li>
<li><code>options</code> are <strong>optional</strong> settings that can be used to fine-tune the usage of the Component but are not required or do not majorly affect behavior. EX additional logging toggles</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=concrete-class>Concrete Class<a href=#concrete-class class=hash-link aria-label="Direct link to Concrete Class" title="Direct link to Concrete Class">​</a></h3>
<p>Components inherit from an abstract base class, <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/src/backend/common/AbstractComponent.ts target=_blank rel="noopener noreferrer"><code>AbstractComponent</code></a>, that defines different "stages" of how a Component is built and initialized when MS first starts as well as when restarting the Component in the event it stops due to an error/network failure/etc...</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id=stages>Stages<a href=#stages class=hash-link aria-label="Direct link to Stages" title="Direct link to Stages">​</a></h4>
<p>Stages below are invoked in the order listed. All stages are asynchronous to allow fetching network requests or reading files.</p>
<p>The stage function (described in each stage below) should return a value or throw:</p>
<ul>
<li>return <code>null</code> if the stage is not required</li>
<li>return <code>true</code> if the stage succeeded</li>
<li>return a <code>string</code> if the stage succeeded and you wish to append a result to the log output for this stage</li>
<li>throw an <code>Exception</code> if the stage failed for any reason and the Component should not continue to run/start up</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=stage-build-data>Stage: Build Data<a href=#stage-build-data class=hash-link aria-label="Direct link to Stage: Build Data" title="Direct link to Stage: Build Data">​</a></h5>
<p>This stage should be used to validate user configuration, parse any additional data from async sources (file, network), and finalize the shape of any configuration/data needed for the Component to operate.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>Implement <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/src/backend/common/AbstractComponent.ts#L71 target=_blank rel="noopener noreferrer"><code>doBuildInitData</code></a> in your child class to invoke this stage.</div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>Examples</summary><div><div class=collapsibleContent_i85q><ul>
<li>Parse a full URL like <code>http://SOME_IP:7000/subfolder/api</code> from user config containing a base url like <code>data.baseUrl: 'SOME_IP'</code> and then store this in the class config</li>
<li>Validate that config <code>data</code> contains required properties <code>user</code> <code>password</code> <code>salt</code></li>
<li>Read stored credentials from <code>${this.configDir}/currentCreds-MySource-${name}.json</code>;</li>
</ul></div></div></details>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=stage-check-connection>Stage: Check Connection<a href=#stage-check-connection class=hash-link aria-label="Direct link to Stage: Check Connection" title="Direct link to Stage: Check Connection">​</a></h5>
<p>This stage is used to validate that MS can communicate with the service the Component is interacting with. This stage is invoked on MS startup as well as any time the Component tries to restart after a failure.</p>
<p>If the Component depends on <strong>ingress</strong> (like Jellyfin/Plex webhook) this stage is not necessary.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>Implement <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/src/backend/common/AbstractComponent.ts#L103 target=_blank rel="noopener noreferrer"><code>doCheckConnection</code></a> in your child class to invoke this stage.</div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>Examples</summary><div><div class=collapsibleContent_i85q><ul>
<li>Make a <a href=https://nodejs.org/docs/latest-v18.x/api/http.html#httprequesturl-options-callback target=_blank rel="noopener noreferrer"><code>request</code></a> to the service's server to ensure it is accessible</li>
<li>Open a websocket connection and check for a ping-pong</li>
</ul></div></div></details>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id=stage-test-auth>Stage: Test Auth<a href=#stage-test-auth class=hash-link aria-label="Direct link to Stage: Test Auth" title="Direct link to Stage: Test Auth">​</a></h5>
<p>MS determines if Auth is required for a Component based on two class properties. You should set these properties during <code>constructor</code> initialization for your Component class:</p>
<ul>
<li><code>requiresAuth</code> - (default <code>false</code>) Set to <code>true</code> if MS should check/test Auth for this Component</li>
<li><code>requiresAuthInteraction</code> - (default <code>false</code>) Set to <code>true</code> if user interaction is required to complete auth IE user needs to visit a callback URL</li>
</ul>
<p>If the Component requires authentication in order to communicate with a service then any required data should be built in this stage and a request made to the service to ensure the authentication data is valid.</p>
<p>This stage should return:</p>
<ul>
<li><code>true</code> if auth succeeded</li>
<li><code>false</code> if auth failed without unexpected errors<!-- -->
<ul>
<li>IE the authentication data is not valid and requires user interaction to resolve the failure</li>
</ul>
</li>
<li>throw an exception if network failure or unexpected error occurred</li>
</ul>
<p>You <em>should</em> attempt to re-authenticate, if possible. Only throw an exception or return <code>false</code> if there is no way to recover from an authentication failure.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class=admonitionHeading_Gvgb><span class=admonitionIcon_Rf37><svg viewBox="0 0 14 16"><path fill-rule=evenodd d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"/></svg></span>info</div><div class=admonitionContent_BuS1><p>Implement <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/src/backend/common/AbstractComponent.ts#L111 target=_blank rel="noopener noreferrer"><code>doAuthentication</code></a> in your child class to invoke this stage.</div></div>
<details class="details_lb9f alert alert--info details_b_Ee" data-collapsed=true><summary>Examples</summary><div><div class=collapsibleContent_i85q><ul>
<li>Generate a Bearer Token for Basic Auth from user/password given in config and store in class properties</li>
<li>Make a request to a known endpoint with Authorization token from read credentials file to see if succeeds or returns 403</li>
<li>Catch a 403 and attempt to reauthenticate at an auth endpoint with user/password given in config</li>
</ul></div></div></details>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id=play-object>Play Object<a href=#play-object class=hash-link aria-label="Direct link to Play Object" title="Direct link to Play Object">​</a></h3>
<p>The <strong>PlayObject</strong> is the standard data structure MS uses to store listen (track) information and data required for scrobbling. It consists of:</p>
<ul>
<li>Track Data -- a standard format for storing track, artists, album, track duration, the date the track was played at, etc...</li>
<li>Listen Metadata -- Optional but useful data related to the specific play or specifics about the Source/Client context for this play such as<!-- -->
<ul>
<li>Platform specific ID, web URL to track, device/user ID that played this track, etc...</li>
</ul>
</li>
</ul>
<p>Both Sources and Clients use the <strong>PlayObject</strong> interface. When a Component receives track info from its corresponding service it must transform this data into a PlayObject before it can be interacted with.</p>
<p>For more refer to the TS documentation for <code>PlayObject</code> or <a href=https://github.com/FoxxMD/multi-scrobbler/blob/master/src/core/Atomic.ts#L141 target=_blank rel="noopener noreferrer"><code>AmbPlayObject</code></a> in your project</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=creating-clients-and-sources>Creating Clients and Sources<a href=#creating-clients-and-sources class=hash-link aria-label="Direct link to Creating Clients and Sources" title="Direct link to Creating Clients and Sources">​</a></h2>
<ul>
<li><a href=/multi-scrobbler/docs/development/dev-source/>Source Development and Tutorial</a></li>
<li><a href=/multi-scrobbler/docs/development/dev-client/>Client Development and Tutorial</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/development/dev-common.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href=/multi-scrobbler/docs/category/development/><div class=pagination-nav__sublabel>Previous</div><div class=pagination-nav__label>Development</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/multi-scrobbler/docs/development/dev-source/><div class=pagination-nav__sublabel>Next</div><div class=pagination-nav__label>Source Development/Tutorial</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#architecture class="table-of-contents__link toc-highlight">Architecture</a><li><a href=#project-setup class="table-of-contents__link toc-highlight">Project Setup</a><ul><li><a href=#vscode class="table-of-contents__link toc-highlight">VSCode</a></ul><li><a href=#common-development class="table-of-contents__link toc-highlight">Common Development</a><ul><li><a href=#config class="table-of-contents__link toc-highlight">Config</a><li><a href=#concrete-class class="table-of-contents__link toc-highlight">Concrete Class</a><ul><li><a href=#stages class="table-of-contents__link toc-highlight">Stages</a><ul><li><a href=#stage-build-data class="table-of-contents__link toc-highlight">Stage: Build Data</a><li><a href=#stage-check-connection class="table-of-contents__link toc-highlight">Stage: Check Connection</a><li><a href=#stage-test-auth class="table-of-contents__link toc-highlight">Stage: Test Auth</a></ul></ul><li><a href=#play-object class="table-of-contents__link toc-highlight">Play Object</a></ul><li><a href=#creating-clients-and-sources class="table-of-contents__link toc-highlight">Creating Clients and Sources</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/multi-scrobbler/>Overview</a><li class=footer__item><a class=footer__link-item href=/multi-scrobbler/docs/installation/>Installation</a><li class=footer__item><a class=footer__link-item href=/multi-scrobbler/docs/configuration/>Configuration</a><li class=footer__item><a class=footer__link-item href=/multi-scrobbler/docs/development/dev-common/>Development</a></ul></div><div class="col footer__col"><div class=footer__title>More</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://github.com/foxxmd/multi-scrobbler target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://foxxmd.github.io/multi-scrobbler/ target=_blank rel="noopener noreferrer" class=footer__link-item>Website<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 Multi-Scrobbler. Built with Docusaurus.</div></div></div></footer></div>
{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","properties":{"name":{"type":"string","description":"Unique identifier for this source."},"data":{"$ref":"#/definitions/PlexApiData"},"enable":{"type":"boolean","description":"Should MS use this client/source? Defaults to true","default":true,"examples":[true]},"clients":{"type":"array","items":{"type":"string"},"description":"Restrict scrobbling tracks played from this source to Clients with names from this list. If list is empty is not present Source scrobbles to all configured Clients.","examples":[["MyMalojaConfigName","MyLastFMConfigName"]]},"options":{"$ref":"#/definitions/PlexApiOptions"}},"required":["data","options"],"definitions":{"PlexApiData":{"type":"object","properties":{"interval":{"type":"number","description":"How long to wait before polling the source API for new tracks (in seconds)","default":10,"examples":[10]},"maxInterval":{"type":"number","description":"When there has been no new activity from the Source API multi-scrobbler will gradually increase the wait time between polling up to this value (in seconds)","default":30,"examples":[30]},"staleAfter":{"type":"number","description":"Number of seconds after which A Player is considered Stale\n\nWhen Polling the source does not recieve data about a specific Player after X seconds it becomes Stale. When the Player becomes Stale:\n\n* The current listening session is ended. If the Player becomes active again a new listening session is started (Player will miss `interval` seconds of listening)\n* If the player has an existing session w/ track then MS attempts to scrobble it\n\nThis option DOES NOT need to be set. It is automatically calculated as (`interval` * 3) when not defined."},"orphanedAfter":{"type":"number","description":"Number of seconds after which A Player is considered Orphaned\n\nWhen Polling the source does not recieve data about a specific Player after X seconds it becomes Orphaned. When the Player becomes Orphaned:\n\n* The current Player session is ended and the Player is removed from MS\n* MS attempts to scrobble, if the Player has an existing session w/ track\n\nA Player should become Orphaned EQUAL TO OR AFTER it becomes Stale.\n\n* This option DOES NOT need to be set. It is automatically calculated as (`interval` * 5) when not defined.\n* If it is set it must be equal to or larger than `staleAfter` or (`interval * 3`)"},"token":{"type":"string"},"url":{"type":"string","description":"http(s)://HOST:PORT of the Plex server to connect to"},"usersAllow":{"anyOf":[{"type":"string"},{"type":"boolean","enum":[true]},{"type":"array","items":{"type":"string"}}],"description":"Only scrobble for specific users (case-insensitive)\n\nIf `true` MS will scrobble activity from all users"},"usersBlock":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}],"description":"Do not scrobble for these users (case-insensitive)"},"devicesAllow":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}],"description":"Only scrobble if device or application name contains strings from this list (case-insensitive)"},"devicesBlock":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}],"description":"Do not scrobble if device or application name contains strings from this list (case-insensitive)"},"librariesAllow":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}],"description":"Only scrobble if library name contains string from this list (case-insensitive)"},"librariesBlock":{"anyOf":[{"type":"string"},{"type":"array","items":{"type":"string"}}],"description":"Do not scrobble if library name contains strings from this list (case-insensitive)"}},"required":["url"],"title":"PlexApiData"},"PlexApiOptions":{"type":"object","properties":{"maxRequestRetries":{"type":"number","description":"default # of http request retries a source/client can make before error is thrown","default":1,"examples":[1]},"retryMultiplier":{"type":"number","description":"default retry delay multiplier (retry attempt * multiplier = # of seconds to wait before retrying)","default":1.5,"examples":[1.5]},"maxPollRetries":{"type":"number","description":"default # of automatic polling restarts on error","default":5,"examples":[5]},"logPayload":{"type":"boolean","description":"* If this source has INGRESS to MS (sends a payload, rather than MS GETTING requesting a payload) then setting this option to true will make MS log the payload JSON to DEBUG output\n* If this source is POLLING then it will log the raw data for each unique track/response the first time it is seen","default":false,"examples":[false]},"logFilterFailure":{"type":["boolean","string"],"enum":[false,"debug","warn"],"description":"If this source has INGRESS to MS and has filters this determines how MS logs when a payload (event) fails a defined filter (IE users/servers/library filters)\n\n* `false` => do not log\n* `debug` => log to DEBUG level\n* `warn` => log to WARN level (default)\n\nHint: This is useful if you are sure this source is setup correctly and you have multiple other sources. Set to `debug` or `false` to reduce log noise.","default":"warn","examples":["warn"]},"logPlayerState":{"type":"boolean","description":"For Sources that track Player State (currently playing) this logs a simple player state/summary to DEBUG output","default":false,"examples":[false]},"logToFile":{"anyOf":[{"type":"boolean","enum":[true]},{"$ref":"#/definitions/LogLevel"},{"$ref":"#/definitions/FileLogOptions"}],"description":"**Exprimental:** Log to a separate file for this Source.\n\nUseful for debugging long-running Sources"},"scrobbleBacklog":{"type":"boolean","description":"If this source\n\n* supports fetching a listen history\n* and this option is enabled\n\nthen on startup MS will attempt to scrobble the recent listens from that history","default":true,"examples":[true,false]},"scrobbleThresholds":{"$ref":"#/definitions/ScrobbleThresholds","description":"Set thresholds for when multi-scrobbler should consider a tracked play to be \"scrobbable\". If both duration and percent are defined then if either condition is met the track is scrobbled."},"scrobbleBacklogCount":{"type":"number","description":"The number of listens to fetch when scrobbling from backlog\n\n* Only applies if this source supports fetching a listen history\n* If not specified it defaults to the maximum number of listens the source API supports"},"playTransform":{"$ref":"#/definitions/PlayTransformOptions"},"ignoreInvalidCert":{"type":"boolean","description":"Ignore invalid cert errors when connecting to Plex\n\nUseful for Plex servers using \"Required\" Secure Connections with self-signed certificates\n\nDo not enable unless you know you need this.","default":false}},"title":"PlexApiOptions"},"LogLevel":{"type":"string","enum":["silent","fatal","error","warn","info","log","verbose","debug"],"description":"Names of log levels that can be invoked on the logger\n\nFrom lowest to highest:\n\n* `debug`\n* `verbose`\n* `log`\n* `info`\n* `warn`\n* `error`\n* `fatal`\n* `silent` (will never output anything)\n\nWhen used in `LogOptions` specifies the **minimum** level the output should log at.","title":"LogLevel"},"FileLogOptions":{"type":"object","properties":{"timestamp":{"type":"string","enum":["unix","iso","auto"],"description":"For rolling log files\n\nWhen\n* value passed to rolling destination is a string (`path` from LogOptions is a string) and\n* `frequency` is defined\n\nThis determines the format of the datetime inserted into the log file name:\n\n* `unix` - unix epoch timestamp in milliseconds\n* `iso`  - Full [ISO8601](https://en.wikipedia.org/wiki/ISO_8601) datetime IE '2024-03-07T20:11:34Z'\n* `auto`\n  * When frequency is `daily` only inserts date IE YYYY-MM-DD\n  * Otherwise inserts full ISO8601 datetime","default":"auto"},"size":{"type":["number","string"],"description":"The maximum size of a given rolling log file.\n\nCan be combined with frequency. Use k, m and g to express values in KB, MB or GB.\n\nNumerical values will be considered as MB.","default":"10MB"},"frequency":{"anyOf":[{"type":"string","enum":["daily"]},{"type":"string","enum":["hourly"]},{"type":"number"}],"description":"The amount of time a given rolling log file is used. Can be combined with size.\n\nUse `daily` or `hourly` to rotate file every day (or every hour). Existing file within the current day (or hour) will be re-used.\n\nNumerical values will be considered as a number of milliseconds. Using a numerical value will always create a new file upon startup.","default":"daily"},"path":{"anyOf":[{"type":"string"},{"$comment":"() => string"}],"description":"The path and filename to use for log files.\n\nIf using rolling files the filename will be appended with `.N` (a number) BEFORE the extension based on rolling status.\n\nMay also be specified using env LOG_PATH or a function that returns a string.\n\nIf path is relative the absolute path will be derived from `logBaseDir` (in `LoggerAppExtras`) which defaults to CWD","default":"./logs/app.log"},"level":{"anyOf":[{"$ref":"#/definitions/LogLevel"},{"type":"boolean","const":false}],"description":"Specify the minimum log level to output to rotating files. If `false` no log files will be created."}},"title":"FileLogOptions"},"ScrobbleThresholds":{"type":"object","properties":{"duration":{"type":["number","null"],"description":"The number of seconds a track has been listened to before it should be considered scrobbled.\n\nSet to null to disable.","default":240,"examples":[240]},"percent":{"type":["number","null"],"description":"The percentage (as an integer) of a track that should have been seen played before it should be scrobbled. Only used if the Source provides information about how long the track is.\n\nSet to null to disable.\n\nNOTE: This should be used with care when the Source is a \"polling\" type (has an 'interval' property). If the track is short and the interval is too high MS may ignore the track if percentage is high because it had not \"seen\" the track for long enough from first discovery, even if you have been playing the track for longer.","default":50,"examples":[50]}},"title":"ScrobbleThresholds"},"PlayTransformOptions":{"type":"object","properties":{"log":{"anyOf":[{"type":"boolean"},{"type":"string","enum":["all"]}]},"preCompare":{"$ref":"#/definitions/PlayTransformPartsConfig%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%3E"},"compare":{"type":"object","properties":{"candidate":{"$ref":"#/definitions/PlayTransformPartsConfig%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%3E"},"existing":{"$ref":"#/definitions/PlayTransformPartsConfig%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%3E"}}},"postCompare":{"$ref":"#/definitions/PlayTransformPartsConfig%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%3E"}},"title":"PlayTransformOptions"},"PlayTransformPartsConfig<(def-alias-617285649-262-339-617285649-0-4914[]|ExternalMetadataTerm)>":{"anyOf":[{"$ref":"#/definitions/PlayTransformPartsArray%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%2CMaybeStageTyped%3E"},{"$ref":"#/definitions/PlayTransformParts%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%2CMaybeStageTyped%3E"}],"description":"Represents the weakly-defined user config. May be an array of parts or one parts object","title":"PlayTransformPartsConfig<(def-alias-617285649-262-339-617285649-0-4914[]|ExternalMetadataTerm)>"},"PlayTransformPartsArray<(def-alias-617285649-262-339-617285649-0-4914[]|ExternalMetadataTerm),MaybeStageTyped>":{"type":"array","items":{"$ref":"#/definitions/PlayTransformParts%3C(def-alias-617285649-262-339-617285649-0-4914%5B%5D%7CExternalMetadataTerm)%2CMaybeStageTyped%3E"},"title":"PlayTransformPartsArray<(def-alias-617285649-262-339-617285649-0-4914[]|ExternalMetadataTerm),MaybeStageTyped>"},"PlayTransformParts<(def-alias-617285649-262-339-617285649-0-4914[]|ExternalMetadataTerm),MaybeStageTyped>":{"anyOf":[{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"},"title":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"artists":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"albumArtists":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"album":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"duration":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"meta":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"onSuccess":{"$ref":"#/definitions/FlowControlTerm"},"onFailure":{"$ref":"#/definitions/FlowControlTerm"},"onSkip":{"$ref":"#/definitions/FlowControlTerm"},"failureReturnPartial":{"type":"boolean"},"type":{"$ref":"#/definitions/StageTypeMetadata"},"name":{"type":"string"},"score":{"type":"number"}},"required":["type"]},{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"},"title":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"artists":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"albumArtists":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"album":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"duration":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"meta":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"onSuccess":{"$ref":"#/definitions/FlowControlTerm"},"onFailure":{"$ref":"#/definitions/FlowControlTerm"},"onSkip":{"$ref":"#/definitions/FlowControlTerm"},"failureReturnPartial":{"type":"boolean"},"type":{"$ref":"#/definitions/StageTypeUser"},"name":{"type":"string"}},"required":["type"]},{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"},"title":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"artists":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"albumArtists":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"album":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"duration":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"meta":{"anyOf":[{"type":"boolean"},{"$ref":"#/definitions/Whennable"}]},"onSuccess":{"$ref":"#/definitions/FlowControlTerm"},"onFailure":{"$ref":"#/definitions/FlowControlTerm"},"onSkip":{"$ref":"#/definitions/FlowControlTerm"},"failureReturnPartial":{"type":"boolean"},"type":{"type":"string","enum":["native"]},"name":{"type":"string"}},"required":["type"]},{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"},"title":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"artists":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"albumArtists":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"album":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"duration":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"meta":{"anyOf":[{"type":"array","items":{"$ref":"#/definitions/SearchAndReplaceTerm"}},{"$ref":"#/definitions/ExternalMetadataTerm"}]},"onSuccess":{"$ref":"#/definitions/FlowControlTerm"},"onFailure":{"$ref":"#/definitions/FlowControlTerm"},"onSkip":{"$ref":"#/definitions/FlowControlTerm"},"failureReturnPartial":{"type":"boolean"},"name":{"type":"string"}}},{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"},"title":{},"artists":{},"albumArtists":{},"album":{},"duration":{},"meta":{},"onSuccess":{"$ref":"#/definitions/FlowControlTerm"},"onFailure":{"$ref":"#/definitions/FlowControlTerm"},"onSkip":{"$ref":"#/definitions/FlowControlTerm"},"failureReturnPartial":{"type":"boolean"},"type":{"type":"string"},"name":{"type":"string"}},"required":["type"]}],"title":"PlayTransformParts<(def-alias-617285649-262-339-617285649-0-4914[]|ExternalMetadataTerm),MaybeStageTyped>"},"WhenConditionsConfig":{"$ref":"#/definitions/WhenConditions%3Cstring%3E","title":"WhenConditionsConfig"},"WhenConditions<string>":{"type":"array","items":{"$ref":"#/definitions/WhenParts%3Cstring%3E"},"title":"WhenConditions<string>"},"WhenParts<string>":{"$ref":"#/definitions/PlayTransformPartsAtomic%3Cstring%3E","title":"WhenParts<string>"},"PlayTransformPartsAtomic<string>":{"type":"object","properties":{"title":{"type":"string"},"artists":{"type":"string"},"albumArtists":{"type":"string"},"album":{"type":"string"},"duration":{"type":"string"},"meta":{"type":"string"}},"title":"PlayTransformPartsAtomic<string>"},"Whennable":{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"}},"title":"Whennable"},"FlowControlTerm":{"type":"string","enum":["continue","stop"],"title":"FlowControlTerm"},"StageTypeMetadata":{"type":"string","enum":["spotify","musicbrainz","native"],"title":"StageTypeMetadata"},"SearchAndReplaceTerm":{"anyOf":[{"type":"string"},{"$ref":"#/definitions/ConditionalSearchAndReplaceTerm"}],"title":"SearchAndReplaceTerm"},"ConditionalSearchAndReplaceTerm":{"$ref":"#/definitions/ConditionalSearchAndReplaceRegExp","title":"ConditionalSearchAndReplaceTerm"},"ConditionalSearchAndReplaceRegExp":{"type":"object","properties":{"when":{"$ref":"#/definitions/WhenConditionsConfig"},"search":{"anyOf":[{"type":"string"},{"type":"string","format":"regex"}],"description":"The search value to test for\n\nCan be a normal string (converted to a case-sensitive literal) or a valid regular expression as a string, or an actual RegExp object","examples":[["find this string","/some string*/ig"]]},"replace":{"type":"string","description":"The replacement string/value to use when search is found\n\nThis can be a literal string like `'replace with this`, an empty string to remove the search value (`''`), or a special regex value\n\nSee replacement here for more information: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace"},"test":{"$comment":"(obj: SearchAndReplaceRegExp) => boolean","type":"object","properties":{"namedArgs":{"type":"object","properties":{"obj":{"$ref":"#/definitions/SearchAndReplaceRegExp"}},"required":["obj"],"additionalProperties":false}},"description":"An optional function to execute before running this search-and-replace that decides if it should run at all"}},"required":["replace","search"],"title":"ConditionalSearchAndReplaceRegExp"},"SearchAndReplaceRegExp":{"type":"object","properties":{"search":{"anyOf":[{"type":"string"},{"type":"string","format":"regex"}],"description":"The search value to test for\n\nCan be a normal string (converted to a case-sensitive literal) or a valid regular expression as a string, or an actual RegExp object","examples":[["find this string","/some string*/ig"]]},"replace":{"type":"string","description":"The replacement string/value to use when search is found\n\nThis can be a literal string like `'replace with this`, an empty string to remove the search value (`''`), or a special regex value\n\nSee replacement here for more information: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace"},"test":{"$comment":"(obj: SearchAndReplaceRegExp) => boolean","type":"object","properties":{"namedArgs":{"type":"object","properties":{"obj":{"$ref":"#/definitions/SearchAndReplaceRegExp"}},"required":["obj"],"additionalProperties":false}},"description":"An optional function to execute before running this search-and-replace that decides if it should run at all"}},"required":["search","replace"],"title":"SearchAndReplaceRegExp"},"ExternalMetadataTerm":{"anyOf":[{"type":"boolean"},{"not":{}},{"$ref":"#/definitions/Whennable"}],"title":"ExternalMetadataTerm"},"StageTypeUser":{"type":"string","enum":["user"],"title":"StageTypeUser"}}}
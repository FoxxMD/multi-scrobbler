"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([["9325"],{77994:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>t,default:()=>h,toc:()=>c,metadata:()=>i,assets:()=>l,contentTitle:()=>o});var i=JSON.parse('{"id":"configuration/transforms/transforms","title":"Enhancing Scrobbles","description":"Multi-scrobbler configs support the ability to enhance scrobble data in an automated fashion by matching and replacing strings in title, artists, and album at many different times in multi-scrobbler\'s lifecycle.","source":"@site/docs/configuration/transforms/transforms.mdx","sourceDirName":"configuration/transforms","slug":"/configuration/transforms/","permalink":"/multi-scrobbler/configuration/transforms/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/configuration/transforms/transforms.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Enhancing Scrobbles","toc_max_heading_level":5},"sidebar":"tutorialSidebar","previous":{"title":"Kitchen Sink","permalink":"/multi-scrobbler/configuration/kitchensink"},"next":{"title":"Musicbrainz Stage","permalink":"/multi-scrobbler/configuration/transforms/musicbrainz"}}'),a=s(85893),r=s(50065);let t={sidebar_position:4,title:"Enhancing Scrobbles",toc_max_heading_level:5},o=void 0,l={},c=[{value:"Journey of a Scrobble",id:"journey-of-a-scrobble",level:2},{value:"Lifecyle Hooks",id:"lifecyle-hooks",level:2},{value:"TLDR",id:"tldr",level:5},{value:"Hook",id:"hook",level:3},{value:"Modification Stage",id:"stage",level:2},{value:"Configuring Stages",id:"configuring-stages",level:3},{value:"Overriding Configuration",id:"overriding-configuration",level:4},{value:"Rules for Play Data",id:"stage-rules",level:3},{value:"Stage Flow Control",id:"flow-control",level:2},{value:"Conditionally Run",id:"conditional-modification",level:3},{value:"Logging",id:"logging",level:2},{value:"Examples",id:"examples",level:2}];function d(e){let n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components},{Details:s}=n;return s||function(e,n){throw Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["Multi-scrobbler configs support the ability to enhance scrobble data in an automated fashion by matching and replacing strings in ",(0,a.jsx)(n.strong,{children:"title, artists, and album"})," at many different times in multi-scrobbler's lifecycle."]}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Why Would I Do This?"}),(0,a.jsx)(n.p,{children:'You may need to "clean up" data from a Source or before sending to a scrobble Client due to any number of reasons:'}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["ID3 tags in your music collection are dirty or have repeating garbage IE ",(0,a.jsx)(n.code,{children:"[YourMusicSource.com] My Artist - My Title"})]}),"\n",(0,a.jsxs)(n.li,{children:["A Source's service often incorrectly adds data to some field IE ",(0,a.jsx)(n.code,{children:"My Artist - My Title (Album Version)"})," when the title should just be ",(0,a.jsx)(n.code,{children:"My Title"})]}),"\n",(0,a.jsx)(n.li,{children:"An Artist you listen to often is spelled different between a Source and a Client which causes duplicate scrobbles"}),"\n"]}),(0,a.jsx)(n.p,{children:"In any scenario where a repeating pattern can be found in the data it would be nice to be able to fix it before the data gets downstream or to help prevent duplicate scrobbling. Multi-scrobbler can help you do this."})]}),"\n",(0,a.jsx)(n.h2,{id:"journey-of-a-scrobble",children:"Journey of a Scrobble"}),"\n",(0,a.jsx)(n.p,{children:"First, let's recap the lifecycle of a scrobble in multi-scrobbler:"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Sources"})," are the beginning of the journey for a ",(0,a.jsx)(n.strong,{children:"Play"})," (song you've listened to long enough to be scrobblable)"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["A Source finds a new valid ",(0,a.jsx)(n.strong,{children:"Play"})]}),"\n",(0,a.jsxs)(n.li,{children:["The Source ",(0,a.jsx)(n.strong,{children:"compares"})," this new Play to all the other Plays it has already seen, if the Play is unique (title/artist/album/listened datetime) then..."]}),"\n",(0,a.jsxs)(n.li,{children:["The Source ",(0,a.jsx)(n.strong,{children:"discovers"})," the Play, adds it to Plays it has seen already, and broadcasts the Play should be scrobbled to all Clients"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Scrobble ",(0,a.jsx)(n.strong,{children:"Clients"})," listen for discovered Plays from Sources, then..."]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["A Client receives a ",(0,a.jsx)(n.strong,{children:"Play"})," from a Source"]}),"\n",(0,a.jsxs)(n.li,{children:["The Client ",(0,a.jsx)(n.strong,{children:"compares"})," this Play to all the other scrobbles it has already seen, if the Play is unique (title/artist/album/listened datetime) then..."]}),"\n",(0,a.jsxs)(n.li,{children:["The Client ",(0,a.jsx)(n.strong,{children:"scrobbles"})," the Play downstream to the scrobble service and adds it as a Scrobble it has seen already"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"lifecyle-hooks",children:"Lifecyle Hooks"}),"\n",(0,a.jsx)(n.p,{children:"You'll notice there is a pattern above that looks like this:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Before"})," data is compared"]}),"\n",(0,a.jsxs)(n.li,{children:["Data is ",(0,a.jsx)(n.strong,{children:"compared"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"After"})," data is compared"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"These points, during both Source and Client processes, are when you can hook into the scrobble lifecycle and modify it."}),"\n",(0,a.jsx)(n.h5,{id:"tldr",children:"TLDR"}),"\n",(0,a.jsxs)(n.p,{children:["In more concrete terms this is the structure of hooks within a configuration (can be used in any ",(0,a.jsx)(n.strong,{children:"Source"})," or ",(0,a.jsx)(n.strong,{children:"Client"}),"):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="lastfm.json" {10-14}',children:'[\n  {\n    "name": "myLastFm",\n    "enable": true,\n    "configureAs": "source",\n    "data": {\n      // ...\n    },\n    "options": {\n      "playTransform": {\n        "preCompare": [/* ... */],\n        "compare": [/* ... */],\n        "postCompare": [/* ... */]\n      }\n    }\n  }\n]\n'})}),"\n",(0,a.jsx)(n.h3,{id:"hook",children:"Hook"}),"\n",(0,a.jsxs)(n.p,{children:["For ",(0,a.jsx)(n.strong,{children:"Sources"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"preCompare"})," - modify Play data immediately when received"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"compare"})," - temporarily modify Play data when it is being compared to see if Play was already discovered"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"postCompare"})," - modify Play data before sending to scrobble ",(0,a.jsx)(n.strong,{children:"Clients"})]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["For ",(0,a.jsx)(n.strong,{children:"Clients"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"preCompare"})," - modify Play data immediately when received"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"compare"})," - temporarily modify Play data when it is being compared to see if it was already scrobbled"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"postCompare"})," - modify Play data before scrobbling it to downstream service and adding to already seen scrobbles"]}),"\n"]}),"\n",(0,a.jsxs)(n.admonition,{type:"tip",children:[(0,a.jsxs)(n.p,{children:["Keep in mind that modifying Scrobble/Play data earlier in the lifecycle will affect that data at all times later in the lifecycle (except when using the ",(0,a.jsx)(n.strong,{children:"compare"})," hook)."]}),(0,a.jsxs)(n.p,{children:["For example, to modify the track so it's the same anywhere it is processed in multi-scrobbler you only need to modify it in the ",(0,a.jsx)(n.strong,{children:"Source's"})," ",(0,a.jsx)(n.code,{children:"preCompare"})," hook because all later processes will receive the data with the modified track."]})]}),"\n",(0,a.jsx)(n.admonition,{title:"TLDR",type:"tip",children:(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["To modify a scrobble coming from one of your Sources use the ",(0,a.jsx)(n.code,{children:"preCompare"})," hook."]})})}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsxs)("summary",{children:["Using ",(0,a.jsx)(n.code,{children:"compare"})," hook"]}),(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"compare"})," ",(0,a.jsx)(n.a,{href:"#hook",children:"hook"})," is slightly different than ",(0,a.jsx)(n.code,{children:"preCompare"})," and ",(0,a.jsx)(n.code,{children:"postCompare"}),". It consists of an object where you define which side(s) of the comparison should be modified. It also ",(0,a.jsx)(n.strong,{children:"does not modify downstream data!"})," Instead, the modifications are made only for use in the comparison."]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="lastfm.json"',children:'[\n  {\n    "name": "myLastFm",\n    // ...\n    "options": {\n      "playTransform": {\n        "compare": [\n          {\n            "candidate": {/* ... */}, // modify the "new" Play being compared\n            "existing": {/* ... */}, // modify all "existing" Play/Scrobbles the new Play is being compared against\n          }\n        ],\n      }\n    }\n  }\n]\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"stage",children:"Modification Stage"}),"\n",(0,a.jsxs)(n.p,{children:["Each ",(0,a.jsx)(n.a,{href:"#hook",children:(0,a.jsx)(n.strong,{children:"hook"})})," is made up of one or more ",(0,a.jsx)(n.strong,{children:"Stages"}),". A Stage is a self-contained, unique way of enhancing or modifying the Play data. Some examples of a Stage:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.a,{href:"/configuration/transforms/user",children:"User"})," Stage allows a user to define search-and-replace terms for Artist/Title/Album"]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.a,{href:"/configuration/transforms/native",children:"Native"})," Stage uses MS's built-in heuristics to extract Artists from a single Artist string"]}),"\n",(0,a.jsxs)(n.li,{children:["The ",(0,a.jsx)(n.a,{href:"/configuration/transforms/musicbrainz",children:"Musicbrainz"})," Stage tries to match Play data with the Musicbrainz database and to standardize the Artist/Title/Album data"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Each Stage in a Hook receives Play data from the previous Stage."}),"\n",(0,a.jsxs)(n.p,{children:["Within a hook, each Stage minimally consists of a ",(0,a.jsx)(n.code,{children:"type"})," to identify what Stage it is along with any other data specific to that stage:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n  "type": "native"\n  // optional, stage specific data here...\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"configuring-stages",children:"Configuring Stages"}),"\n",(0,a.jsxs)(n.p,{children:["Stages may be globally configured using ",(0,a.jsx)(n.a,{href:"/configuration?configType=aio#configuration-types",children:"AIO Config"})," ",(0,a.jsx)(n.code,{children:"config.json"})," file in the top-level ",(0,a.jsx)(n.code,{children:"transformers"})," block."]}),"\n",(0,a.jsx)(n.p,{children:"Each Stage consists of:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"type"})," the type of Stage"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"name"})," a unique name for the Stage, to be (potentially) used with hooks"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"defaults"})," - An object defining default configuration for this stage, when used in a Hook."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"data"})," - An object containing any data required to initially configure the stage itself (Example: API URL, username, password, etc...)"]}),"\n"]}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Example"}),(0,a.jsxs)(n.p,{children:["Your ",(0,a.jsx)(n.a,{href:"/configuration?configType=aio#configuration-types",children:"AIO Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="config.json"',children:'{\n  // ...\n  "transformers": [\n    {\n      "type": "native",\n      "name": "MyNativeTransformer",\n      "defaults": {\n        // default delimiters when this Stage is used in a hook\n        "delimiters": [\n          "\u2022"\n        ],\n        // default delimiters when this Stage is used in a hook\n        "artistsParseFrom": ["artists"]\n      }\n    }\n  ]\n}\n'})}),(0,a.jsxs)(n.p,{children:["In a ",(0,a.jsx)(n.a,{href:"/configuration/sources/subsonic",children:"Subsonic"})," ",(0,a.jsx)(n.a,{href:"/configuration?configType=file#configuration-types",children:"File Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="subsonic.json"',children:'[\n  { \n    "name": "MySubsonic",\n    "data": { /* ... */},\n    "options": {\n      "playTransform": {\n        "preCompare": [\n          {\n            "type": "native"\n            // when "name" is not defined, uses first found "native" transformer\n          }\n        ]\n      }\n    }\n  }\n]\n'})})]}),"\n",(0,a.jsx)(n.p,{children:"Multiple stages of the same type may be configured, allowing you to define several sets of default behavior."}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Example"}),(0,a.jsxs)(n.p,{children:["Your ",(0,a.jsx)(n.a,{href:"/configuration?configType=aio#configuration-types",children:"AIO Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="config.json"',children:'{\n  // ...\n  "transformers": [\n    {\n      "type": "native",\n      "name": "DotTransformer",\n      "defaults": {\n        "delimiters": [\n          "\u2022"\n        ],\n        "artistsParseFrom": ["artists"]\n      }\n    },\n    {\n      "type": "native",\n      "name": "TitleOnly",\n      "defaults": {\n        // extracts and uses *only* artists found in title string\n        "artistsParseFrom": ["title"]\n      }\n    }\n  ]\n}\n'})}),(0,a.jsxs)(n.p,{children:["In a ",(0,a.jsx)(n.a,{href:"/configuration/sources/subsonic",children:"Subsonic"})," ",(0,a.jsx)(n.a,{href:"/configuration?configType=file#configuration-types",children:"File Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="subsonic.json"',children:'[\n  { \n    "name": "MySubsonic",\n    "data": { /* ... */},\n    "options": {\n      "playTransform": {\n        "preCompare": [\n          {\n            "type": "native"\n            "name": "DotTransformer"\n          }\n        ]\n      }\n    }\n  }\n]\n'})}),(0,a.jsxs)(n.p,{children:["In a ",(0,a.jsx)(n.a,{href:"/configuration/sources/vlc",children:"VLC"})," ",(0,a.jsx)(n.a,{href:"/configuration?configType=file#configuration-types",children:"File Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="vlc.json"',children:'[\n  { \n    "name": "MyVLC",\n    "data": { /* ... */},\n    "options": {\n      "playTransform": {\n        "preCompare": [\n          {\n            "type": "native"\n            "name": "TitleOnly"\n          }\n        ]\n      }\n    }\n  }\n]\n'})})]}),"\n",(0,a.jsx)(n.h4,{id:"overriding-configuration",children:"Overriding Configuration"}),"\n",(0,a.jsx)(n.p,{children:"The default configuration you set for your Stage may be overridden in any usage of the Stage within a Hook."}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Example"}),(0,a.jsxs)(n.p,{children:["Your ",(0,a.jsx)(n.a,{href:"/configuration?configType=aio#configuration-types",children:"AIO Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="config.json"',children:'{\n  // ...\n  "transformers": [\n    {\n      "type": "native",\n      "name": "MyNativeTransformer",\n      "defaults": {\n        // default delimiters when this Stage is used in a hook\n        "delimiters": [\n          "\u2022"\n        ],\n        // default delimiters when this Stage is used in a hook\n        "artistsParseFrom": ["artists"]\n      }\n    }\n  ]\n}\n'})}),(0,a.jsxs)(n.p,{children:["In a ",(0,a.jsx)(n.a,{href:"/configuration/sources/subsonic",children:"Subsonic"})," ",(0,a.jsx)(n.a,{href:"/configuration?configType=file#configuration-types",children:"File Config"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="subsonic.json"',children:'[\n  { \n    "name": "MySubsonic",\n    "data": { /* ... */},\n    "options": {\n      "playTransform": {\n        "preCompare": [\n          {\n            "type": "native"\n            "name": "MyNativeTransformer",\n            // overrides property from "defaults"\n            "artistsParseFrom": ["artists", "title"]\n          }\n        ]\n      }\n    }\n  }\n]\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"stage-rules",children:"Rules for Play Data"}),"\n",(0,a.jsxs)(n.p,{children:["Each ",(0,a.jsx)(n.a,{href:"#stage",children:"Stage"})," may specify whether it should apply the resulting transformation to different parts of the Play data by specifying ",(0,a.jsx)(n.code,{children:"title"}),", ",(0,a.jsx)(n.code,{children:"artists"})," and/or ",(0,a.jsx)(n.code,{children:"album"})," in the Stage object."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n    "type": "native",\n    // ...\n    "title": false, // will not apply any changes to Play title\n    "artists": {\n      "when": {/* ... */}, // will only apply changes to Play artists if "when" is satisfied\n    /* ... */\n    },\n    "albumArtists": true, // will always apply changes to Play album artists\n    "album": true, // will always apply changes to Play album\n    "duration": true, // will always apply changes to Play duration (length of track)\n    "meta": true, // will always apply changes to Play meta (MBIDs, spotify links, etc...)\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"The actual value of each property may be different for each Stage. Check the docs for the Stage you want to use to see its usage of each."}),"\n",(0,a.jsxs)(n.p,{children:["Generically, though, each property may be some value ",(0,a.jsx)(n.strong,{children:"or"})," an object combining a ",(0,a.jsxs)(n.a,{href:"#conditional-modification",children:[(0,a.jsx)(n.code,{children:"when"})," condition"]})," and that value."]}),"\n",(0,a.jsx)(n.p,{children:"If none of the properties are specified in the stage then it's assumed all transformed data should be used."}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["Specifying these Rules is ",(0,a.jsx)(n.strong,{children:"not"})," the same as ",(0,a.jsx)(n.a,{href:"#configuring-stages",children:"configuring the Stage"}),". Rules only determine if the ",(0,a.jsx)(n.em,{children:"result"})," of the transformation should be used (replace) the existing Play Data."]})}),"\n",(0,a.jsx)(n.h2,{id:"flow-control",children:"Stage Flow Control"}),"\n",(0,a.jsxs)(n.p,{children:["Stages may be optionally configured to ",(0,a.jsx)(n.strong,{children:"continue"})," to the next Stage or ",(0,a.jsx)(n.strong,{children:"stop"})," (end early) all subsequent Stages, based on the outcome of the currently running Stage."]}),"\n",(0,a.jsxs)(n.p,{children:["These three properties can be added to the ",(0,a.jsx)(n.a,{href:"#modification-stage",children:"Modification Stage"})," data, alongside ",(0,a.jsx)(n.a,{href:"#rules-for-play-data",children:"Rules"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"onSuccess"})," (default ",(0,a.jsx)(n.code,{children:"continue"}),") - If the Stage successfully finishes processing"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"onFailure"})," (default ",(0,a.jsx)(n.code,{children:"stop"}),") - If the Stage encounters an error while processing, or otherwise fails to achieve the transformation result"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"onSkip"})," (default ",(0,a.jsx)(n.code,{children:"continue"}),") - If the Stage does not process the Play data due to stage-level ",(0,a.jsx)(n.a,{href:"#conditional-modification",children:(0,a.jsx)(n.code,{children:"when"})})," or other stage-specific skip conditions"]}),"\n"]}),"\n",(0,a.jsxs)(n.admonition,{type:"tip",children:[(0,a.jsx)(n.p,{children:"The default behaviors for Flow Control are the same as you would intuitively think Stages should run IE the next Stage you have defined runs if the current Stage does not fail."}),(0,a.jsx)(n.p,{children:"Specifying Flow Control is only necessary if the above assumptions are not true for your scenario."}),(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Default Flow Control Example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="subsonic.json"',children:'    // ...\n    "options": {\n      "playTransform": {\n        "preCompare": [\n          {\n            // if this stage is successful, native is run\n            // if this stage fails, native does not run\n            "type": "musicbrainz",\n            "name": "MyMB"\n          },\n          {\n            "type": "native",\n            "name": "MyNative"\n          }\n        ]\n      }\n    }\n'})})]})]}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Customized Flow Control Example"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",metastring:'title="subsonic.json"',children:'    // ...\n    "options": {\n      "playTransform": {\n        "preCompare": [\n          {\n            // if musicbrainz is successful then do NOT run native,\n            // only run native if musicbrainz fails to find a match (onFailure)\n            "type": "musicbrainz",\n            "name": "MyMB"\n            "onSuccess": "stop",\n            "onFailure": "continue"\n          },\n          {\n            "type": "native",\n            "name": "MyNative"\n          }\n        ]\n      }\n    }\n'})})]}),"\n",(0,a.jsx)(n.h3,{id:"conditional-modification",children:"Conditionally Run"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.a,{href:"#stage",children:"Stages"})," within a ",(0,a.jsx)(n.a,{href:"#hook",children:"Hook"}),", and ",(0,a.jsx)(n.a,{href:"#stage-rules",children:"Rules"})," within each Stage, support a ",(0,a.jsx)(n.code,{children:"when"})," object for testing ",(0,a.jsx)(n.strong,{children:"if they should be run."})]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"when"})," object may have propertes for rule. Each property may be a string or regular expression.  The value of the property is used to match the ",(0,a.jsx)(n.strong,{children:"pre-transformation"})," values from Play data."]}),"\n",(0,a.jsxs)(n.p,{children:["All parts of an individual ",(0,a.jsx)(n.code,{children:"when"}),' clause must test true to "pass" but if ',(0,a.jsx)(n.strong,{children:"any"})," ",(0,a.jsx)(n.code,{children:"when"})," clauses pass the Stage/Rule is processed."]}),"\n",(0,a.jsxs)(n.p,{children:["If the ",(0,a.jsx)(n.code,{children:"when"})," test does not pass then the Stage is ",(0,a.jsx)(n.a,{href:"#flow-control",children:(0,a.jsxs)(n.strong,{children:["skipped (",(0,a.jsx)(n.code,{children:"onSkip"}),")"]})}),"."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n  "when":\n    {\n      "artist": "Elephant Gym", // Play must have an artist matching "Elephant Gym" (AND)\n      "album": "Dreams" // Play object must have an album  matching "Dreams" (AND)\n    }\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n  "when": [\n    {\n      "artist": "Elephant Gym", // Play must have an artist matching "Elephant Gym" (AND)\n      "album": "Dreams" // Play object must have an album  matching "Dreams" (AND)\n    },\n    // OR\n    {\n      "title": "/(Remastered)$/", // Play title must match regular expression (AND)\n      "album": "Various Artists" // Play album must match "Various Artists" (AND)\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"More succinctly:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["All parts (",(0,a.jsx)(n.code,{children:"artist"})," ",(0,a.jsx)(n.code,{children:"album"})," ",(0,a.jsx)(n.code,{children:"albumArtist"})," ",(0,a.jsx)(n.code,{children:"duration"})," ",(0,a.jsx)(n.code,{children:"meta"})," ",(0,a.jsx)(n.code,{children:"title"}),") of a ",(0,a.jsx)(n.code,{children:"when"})," are ",(0,a.jsx)(n.code,{children:"AND"})," conditions"]}),"\n",(0,a.jsxs)(n.li,{children:["All part-objects in the ",(0,a.jsx)(n.code,{children:"when"})," array are ",(0,a.jsx)(n.code,{children:"OR"})," conditions"]}),"\n"]}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsxs)("summary",{children:["Example of Stage with ",(0,a.jsx)(n.code,{children:"when"})," condition"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n  // IF the artist is Elephant Gym \n  // THEN Run native stage\n  "playTransform": {\n    "preCompare": [\n      {\n        "type": "native",\n        "when": [\n          {\n            "artist": "/Elephant Gym/"\n          }\n        ]\n      }\n    ],\n  }\n}\n'})})]}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Example of individual rule with when condition"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n  // Always run native Stage\n  //\n  //     IF artist matches "Elephant Gym"\n  //     THEN use result of native stage for "artists" of Play data\n  "playTransform": {\n    "preCompare": {\n      "type": "native",\n      "artists":\n        {\n          "when": [\n            {\n              "artist": "/Elephant Gym/"\n            }\n          ]\n        },\n    }\n  }\n}\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"logging",children:"Logging"}),"\n",(0,a.jsxs)(n.p,{children:["MS can log a diff of Stage transformations if/when they occur. In the ",(0,a.jsx)(n.code,{children:"playTransform"})," object of a Source/Client config use ",(0,a.jsx)(n.code,{children:"log"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:'"log": true'})," => Output original play + final transformed output of last Stage in the array","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["This can also be enabled by using ",(0,a.jsx)(n.a,{href:"/configuration/#debug-mode",children:(0,a.jsx)(n.code,{children:"DEBUG_MODE=true"})})]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:'"log": "all"'})," => Output original play + final transformed output of ",(0,a.jsx)(n.strong,{children:"each"})," Stage in the array"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json5",children:'{\n  "name": "myThing",\n  "data": {/*...*/},\n  "options": {\n    "playTransform": {\n      "preCompare": {/*...*/},\n      "log": true\n    }\n  }\n}\n'})}),"\n",(0,a.jsxs)(s,{children:[(0,a.jsx)("summary",{children:"Example"}),(0,a.jsx)(n.p,{children:"The output shows the diff between the previous stage (or original Play) and the current stage. In docker logs this is highlighted with diff syntax:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-diff",children:'[2025-12-17 08:53:10.467 -0500] DEBUG  : [App] [Sources] [Lastfm - mylfm] [Play Transform] [preCompare] [VLDJJo] Transform Diff\n- Original\n+ musicbrainz-MyMB\n\n  Title        : Demons Theme Part II (original 12" mix)\n  Artists      : LTJ Bukem\n  Album Artists: (None)\n- Album        : Producer 05: Rarities (Original 12" Version)\n+ Album        : Producer 05: Rarities (original 12" version)\n  Meta         : \n  * brainz-album: 36759a8a-d3df-47da-a236-60f84fdc0cab\n+ * brainz-artist: 28c1b7b7-355a-48b1-b2c4-75b8eb8080ef\n+ * brainz-track: a0d51240-7ef1-4676-882e-be9f354075cb\n+ * brainz-releaseGroup: e0cce74f-abcc-343b-9390-1673e4d57ce7\n'})})]}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.strong,{children:"Examples"})," sections in specific Stage docs (also in the sidebar):"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/configuration/transforms/user#examples",children:"User Stage"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/configuration/transforms/native#examples",children:"Native Stage"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/configuration/transforms/musicbrainz#examples",children:"Musicbrainz Stage"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);